# Amazon SageMaker built-in BlazingText
BlazingTextにはUnsupervised（教師なし）とSupervised（教師あり）の2つのタイプがあります。
- UnsupervisedはWord2vecと類似したもので、効率的な実装でスケールがとれるようになっています。
  - CBOW, Skip-gramに加え、分散学習に対応したbatch_skipgramアルゴリズムも選択できます。
- Supervisedはテキスト分類に対応しています。

|          Modes         	| cbow (supports subwords training) 	| skipgram (supports subwords training) 	| batch_skipgram 	| supervised |
|:----------------------:	|:----:	|:--------:	|:--------------:	| :--------------:	|
|   Single CPU instance  	|   ✔  	|     ✔    	|        ✔       	|  ✔  |
|   Single GPU instance  	|   ✔  	|     ✔    	|         -       	|  ✔ (Instance with 1 GPU only)  |
| Multiple CPU instances 	|     - 	|        -  	|        ✔       	|  -   | |

### Unsupervised
- AmazonSageMakerのビルトインアルゴリズムの一つであるBlazingText（教師なし）を使用したexample
- [Hironsan](https://github.com/Hironsan)さんの公開している[ja.text8](https://github.com/Hironsan/ja.text8)を使用


#### 推論Output
```python
words = ["日本", "五輪"]
payload = {"instances": words}

response = bt_endpoint.predict(
    json.dumps(payload),
    initial_args={"ContentType": "application/json", "Accept": "application/json"},
)
vecs = json.loads(response)
print(vecs)
# [{'vector': [0.3257896304130554, 0.08846154063940048, -0.2831537425518036, -0.022332629188895226, 0.06330227851867676, 0.898602306842804, -0.10062314569950104, 0.2514721155166626, 0.03162052482366562, -0.2084859013557434, -0.2442259043455124, 0.3889232277870178, -0.3938072919845581, -0.18988364934921265, -0.8527834415435791, -0.4013861417770386, -0.2077806293964386, -0.08185669779777527, -0.40482470393180847, 0.39533889293670654, 0.14145803451538086, 0.09822560101747513, -0.43365544080734253, 0.081038698554039, -0.020527146756649017, 0.44209980964660645, 0.10028132796287537, 0.21395394206047058, -0.05575378239154816, 0.25131988525390625, 0.48860853910446167, -0.012177038937807083, 0.6126131415367126, 0.020621005445718765, -0.30051738023757935, -0.03171280026435852, -0.08884930610656738, -0.1795523464679718, 0.18248605728149414, -0.5630799531936646, 0.13062354922294617, 0.517485499382019, 0.27202507853507996, -0.005406031850725412, -0.0770132839679718, -0.09297877550125122, 0.23551928997039795, -0.43581217527389526, 0.2540090084075928, 0.28213295340538025, -0.27826690673828125, 0.09370593726634979, -0.010265952907502651, 0.22133836150169373, -0.00997755117714405, -0.5881315469741821, -0.40026676654815674, 0.09619509428739548, -0.2787875831127167, -0.18156033754348755, 0.036105841398239136, 0.12160005420446396, 0.1767021119594574, 0.09286845475435257, 0.17760156095027924, 0.0067692226730287075, -0.30490174889564514, -0.2683597207069397, -0.011137081310153008, -0.12569659948349, -0.407621830701828, 0.2247025966644287, 0.39354634284973145, 0.06620488315820694, -0.32754015922546387, 0.30952689051628113, 0.12077505886554718, 0.46255528926849365, -0.4598761796951294, 0.27541905641555786, 0.13372929394245148, 0.2645244598388672, 0.29741036891937256, 0.21995365619659424, -0.1376703679561615, 0.22744998335838318, 0.11274227499961853, -0.22304490208625793, -0.3313055634498596, 0.00890134647488594, -0.37325519323349, 0.07163532078266144, 0.5515594482421875, -0.1682979166507721, 0.013898784294724464, 0.0685320571064949, -0.05173557251691818, -0.5312536954879761, -0.2654346823692322, -0.2567465603351593], 'word': '日本'}, {'vector': [-0.474886029958725, -0.33325448632240295, 0.32014018297195435, -0.0017942588310688734, 0.5196096897125244, -0.6096723079681396, -0.3227888345718384, -0.28827202320098877, 0.10932818055152893, -0.48102235794067383, -0.2672668695449829, -0.0683978721499443, -0.7442104816436768, -0.24377277493476868, 0.21426740288734436, -0.01927075907588005, -0.652885377407074, -0.338240385055542, 0.009011557325720787, 0.09174910187721252, 0.6786844730377197, 0.04254155233502388, -0.005260260310024023, 0.37309005856513977, -0.28771427273750305, 0.004799286834895611, 0.06432794779539108, -0.12781575322151184, 0.05819854140281677, -0.2952772378921509, 0.2517338991165161, 0.21491406857967377, -0.21946676075458527, 0.33574172854423523, 0.172837495803833, 0.15437540411949158, 0.11930608749389648, 0.22298938035964966, 0.02380361221730709, 0.2851487398147583, -0.0492604598402977, -0.44559285044670105, 0.021388940513134003, 0.13845770061016083, 0.5804923176765442, -0.27774542570114136, -0.3593218922615051, 0.24586457014083862, 0.3324810266494751, 0.16788117587566376, -0.24919436872005463, 0.2341698706150055, 0.07739768177270889, -0.18502125144004822, 0.2458336502313614, -0.01821986213326454, -0.3713929057121277, 0.2741345763206482, -0.30532220005989075, 0.29402703046798706, 0.35194116830825806, 0.06454668939113617, 0.4765491485595703, 0.04816799983382225, -0.47079992294311523, 0.02461862564086914, -0.44223248958587646, -0.6506072282791138, 0.4105801284313202, -0.09478804469108582, -0.22024959325790405, 0.4407649636268616, 0.3297187387943268, 0.44041648507118225, 0.2008657157421112, -0.06742113828659058, -0.20039956271648407, -0.13410723209381104, 0.3687036633491516, -0.4632264971733093, -0.27035748958587646, -0.1033533439040184, -0.7752053141593933, 0.13822665810585022, 0.6801375150680542, 0.3754267692565918, -0.34474149346351624, 0.0006541344337165356, -0.33586692810058594, 0.5923800468444824, -0.2362634837627411, -0.27999401092529297, 0.9637343883514404, -0.4737914204597473, -1.2404905557632446, -0.7856136560440063, -0.28486907482147217, -0.5987845659255981, 0.23199978470802307, -0.4538081884384155], 'word': '五輪'}]
```

#### 学習した単語ベクトルをt-SNEで視覚化
![](https://user-images.githubusercontent.com/40932835/127270645-4de2c430-815b-43a1-b8e7-71fb860e53fc.png)

#### 学習した単語ベクトルはgensimからロードすることも可能
外部で学習したモデルをホスティングすることも可能です。詳細は[こちら](https://github.com/aws/amazon-sagemaker-examples/tree/master/introduction_to_amazon_algorithms/blazingtext_hosting_pretrained_fasttext)

```python
from gensim.models import KeyedVectors

word_vectors = KeyedVectors.load_word2vec_format('vectors.txt', binary=False)
word_vectors.most_similar(['日本'])
#[('。日本', 0.6449089050292969),
# ('韓国', 0.6217783093452454),
# ('アメリカ', 0.6039219498634338),
# ('米国', 0.5889443755149841),
# ('欧米', 0.5638164281845093),
# ('中国', 0.5610917210578918),
# ('台湾', 0.5560908317565918),
# ('。アメリカ', 0.5548822283744812),
# ('北海道', 0.5416659712791443),
# ('英国', 0.5354906320571899)]
```

### Supervised
- Coming soon


### Reference
- [Amazon SageMaker Developer Guide](https://docs.aws.amazon.com/sagemaker/latest/dg/blazingtext.html)
- [blazingtext_word2vec_text8](https://github.com/aws/amazon-sagemaker-examples/tree/master/introduction_to_amazon_algorithms/blazingtext_word2vec_text8)
- [blazingtext_hosting_pretrained_fasttext](https://github.com/aws/amazon-sagemaker-examples/tree/master/introduction_to_amazon_algorithms/blazingtext_hosting_pretrained_fasttext)
- [日本語版text8コーパスを作って分散表現を学習する](https://hironsan.hatenablog.com/entry/japanese-text8-corpus)
